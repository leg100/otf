{{ template "layout" . }}

{{ define "container-header" }}
  <a href="{{ teamsPath .Organization }}">teams</a>
  /
{{ .Team.Name }}{{ end }}

{{ define "content" }}
  {{ $canSetPermission := .CurrentUser.IsOwner .Organization }}
  <h3>Permissions</h3>
  <form class="permissions-form" action="{{ updateTeamPath .Team.ID }}" method="POST">
    <div class="field">
      <input
        type="checkbox"
        name="manage_workspaces"
        id="manage_workspaces"
        value="true"
        {{ if or .Team.OrganizationAccess.ManageWorkspaces .Team.IsOwners }}checked{{ end }}
        {{ if or (not $canSetPermission) .Team.IsOwners }}disabled{{ end }}
      >
      <label for="manage_workspaces">Manage Workspaces: Allows members to create and administrate all workspaces within the organization.</label>
    </div>
    <div class="field">
      <input
        type="checkbox"
        name="manage_vcs"
        id="manage_vcs"
        value="true"
        {{ if or .Team.OrganizationAccess.ManageVCS .Team.IsOwners }}checked{{ end }}
        {{ if or (not $canSetPermission) .Team.IsOwners }}disabled{{ end }}
      >
      <label for="manage_vcs">Manage VCS Settings: Allows members to manage the set of VCS providers available within the organization.</label>
    </div>
    <div class="field">
      <input
        type="checkbox"
        name="manage_registry"
        id="manage_registry"
        value="true"
        {{ if or .Team.OrganizationAccess.ManageRegistry .Team.IsOwners }}checked{{ end }}
        {{ if or (not $canSetPermission) .Team.IsOwners }}disabled{{ end }}
      >
      <label for="manage_registry">Manage Registry: Allows members to publish and delete modules within the organization.</label>
    </div>
    <div class="field">
      <button {{ disabled (or (not $canSetPermission) .Team.IsOwners) }}>Save changes</button>
    </div>
  </form>
  <br>
  <h3>Members</h3>
  {{ $canAddMember := .CurrentUser.CanAccessOrganization .AddTeamMembershipAction .Organization }}
  {{ $canRemoveMember := .CurrentUser.CanAccessOrganization .RemoveTeamMembershipAction .Organization }}
  <form class="horizontal-form" action="{{ addMemberTeamPath .Team.ID }}" method="POST">
    <input
      type="text"
      name="username"
      id="add-username"
      required
      placeholder="username"
      {{ disabled (not $canAddMember) }}>
    <button
      type="submit"
      {{ if not $canAddMember }}title="insufficient permissions" disabled{{ end }}>
      Add member
    </button>
  </form>
  <div id="content-list" class="content-list">
    {{ range .Members }}
      <div id="item-user-{{ .Username }}" class="item">
        <div class="item-heading">
          <span class="status">{{ .Username }}</span>
        </div>
        <div class="item-content">
          {{ template "identifier" . }}
          <form class="horizontal-form" action="{{ removeMemberTeamPath $.Team.ID }}" method="POST">
            <input type="hidden" name="username" id="delete-username" value="{{ .Username }}">
            <button
              class="delete"
              {{ if not $canRemoveMember }}title="insufficient permissions" disabled{{ end }}
              onclick="return confirm('Are you sure you want to delete?')">
              Remove member
            </button>
          </form>
        </div>
      </div>
    {{ else }}
      No members currently exist.
    {{ end }}
  </div>
{{ end }}
