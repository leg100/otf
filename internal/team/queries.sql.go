// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.28.0
// source: queries.sql

package team

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
	"github.com/leg100/otf/internal/organization"
	"github.com/leg100/otf/internal/resource"
)

const deleteTeamByID = `-- name: DeleteTeamByID :one
DELETE
FROM teams
WHERE team_id = $1
RETURNING team_id
`

func (q *Queries) DeleteTeamByID(ctx context.Context, db DBTX, teamID resource.ID) (resource.ID, error) {
	row := db.QueryRow(ctx, deleteTeamByID, teamID)
	var team_id resource.ID
	err := row.Scan(&team_id)
	return team_id, err
}

const deleteTeamTokenByID = `-- name: DeleteTeamTokenByID :one
DELETE
FROM team_tokens
WHERE team_id = $1
RETURNING team_token_id
`

func (q *Queries) DeleteTeamTokenByID(ctx context.Context, db DBTX, teamID resource.ID) (resource.ID, error) {
	row := db.QueryRow(ctx, deleteTeamTokenByID, teamID)
	var team_token_id resource.ID
	err := row.Scan(&team_token_id)
	return team_token_id, err
}

const findTeamByID = `-- name: FindTeamByID :one
SELECT team_id, name, created_at, permission_manage_workspaces, permission_manage_vcs, permission_manage_modules, organization_name, sso_team_id, visibility, permission_manage_policies, permission_manage_policy_overrides, permission_manage_providers
FROM teams
WHERE team_id = $1
`

func (q *Queries) FindTeamByID(ctx context.Context, db DBTX, teamID resource.ID) (Model, error) {
	row := db.QueryRow(ctx, findTeamByID, teamID)
	var i Model
	err := row.Scan(
		&i.TeamID,
		&i.Name,
		&i.CreatedAt,
		&i.PermissionManageWorkspaces,
		&i.PermissionManageVCS,
		&i.PermissionManageModules,
		&i.OrganizationName,
		&i.SSOTeamID,
		&i.Visibility,
		&i.PermissionManagePolicies,
		&i.PermissionManagePolicyOverrides,
		&i.PermissionManageProviders,
	)
	return i, err
}

const findTeamByIDForUpdate = `-- name: FindTeamByIDForUpdate :one
SELECT team_id, name, created_at, permission_manage_workspaces, permission_manage_vcs, permission_manage_modules, organization_name, sso_team_id, visibility, permission_manage_policies, permission_manage_policy_overrides, permission_manage_providers
FROM teams t
WHERE team_id = $1
FOR UPDATE OF t
`

func (q *Queries) FindTeamByIDForUpdate(ctx context.Context, db DBTX, teamID resource.ID) (Model, error) {
	row := db.QueryRow(ctx, findTeamByIDForUpdate, teamID)
	var i Model
	err := row.Scan(
		&i.TeamID,
		&i.Name,
		&i.CreatedAt,
		&i.PermissionManageWorkspaces,
		&i.PermissionManageVCS,
		&i.PermissionManageModules,
		&i.OrganizationName,
		&i.SSOTeamID,
		&i.Visibility,
		&i.PermissionManagePolicies,
		&i.PermissionManagePolicyOverrides,
		&i.PermissionManageProviders,
	)
	return i, err
}

const findTeamByName = `-- name: FindTeamByName :one
SELECT team_id, name, created_at, permission_manage_workspaces, permission_manage_vcs, permission_manage_modules, organization_name, sso_team_id, visibility, permission_manage_policies, permission_manage_policy_overrides, permission_manage_providers
FROM teams
WHERE name              = $1
AND   organization_name = $2
`

type FindTeamByNameParams struct {
	Name             pgtype.Text
	OrganizationName organization.Name
}

func (q *Queries) FindTeamByName(ctx context.Context, db DBTX, arg FindTeamByNameParams) (Model, error) {
	row := db.QueryRow(ctx, findTeamByName, arg.Name, arg.OrganizationName)
	var i Model
	err := row.Scan(
		&i.TeamID,
		&i.Name,
		&i.CreatedAt,
		&i.PermissionManageWorkspaces,
		&i.PermissionManageVCS,
		&i.PermissionManageModules,
		&i.OrganizationName,
		&i.SSOTeamID,
		&i.Visibility,
		&i.PermissionManagePolicies,
		&i.PermissionManagePolicyOverrides,
		&i.PermissionManageProviders,
	)
	return i, err
}

const findTeamByTokenID = `-- name: FindTeamByTokenID :one
SELECT t.team_id, t.name, t.created_at, t.permission_manage_workspaces, t.permission_manage_vcs, t.permission_manage_modules, t.organization_name, t.sso_team_id, t.visibility, t.permission_manage_policies, t.permission_manage_policy_overrides, t.permission_manage_providers
FROM teams t
JOIN team_tokens tt USING (team_id)
WHERE tt.team_token_id = $1
`

func (q *Queries) FindTeamByTokenID(ctx context.Context, db DBTX, tokenID resource.ID) (Model, error) {
	row := db.QueryRow(ctx, findTeamByTokenID, tokenID)
	var i Model
	err := row.Scan(
		&i.TeamID,
		&i.Name,
		&i.CreatedAt,
		&i.PermissionManageWorkspaces,
		&i.PermissionManageVCS,
		&i.PermissionManageModules,
		&i.OrganizationName,
		&i.SSOTeamID,
		&i.Visibility,
		&i.PermissionManagePolicies,
		&i.PermissionManagePolicyOverrides,
		&i.PermissionManageProviders,
	)
	return i, err
}

const findTeamTokensByID = `-- name: FindTeamTokensByID :many
SELECT team_token_id, description, created_at, team_id, expiry
FROM team_tokens
WHERE team_id = $1
`

func (q *Queries) FindTeamTokensByID(ctx context.Context, db DBTX, teamID resource.ID) ([]TeamToken, error) {
	rows, err := db.Query(ctx, findTeamTokensByID, teamID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []TeamToken
	for rows.Next() {
		var i TeamToken
		if err := rows.Scan(
			&i.TeamTokenID,
			&i.Description,
			&i.CreatedAt,
			&i.TeamID,
			&i.Expiry,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const findTeamsByOrg = `-- name: FindTeamsByOrg :many
SELECT team_id, name, created_at, permission_manage_workspaces, permission_manage_vcs, permission_manage_modules, organization_name, sso_team_id, visibility, permission_manage_policies, permission_manage_policy_overrides, permission_manage_providers
FROM teams
WHERE organization_name = $1
`

func (q *Queries) FindTeamsByOrg(ctx context.Context, db DBTX, organizationName organization.Name) ([]Model, error) {
	rows, err := db.Query(ctx, findTeamsByOrg, organizationName)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Model
	for rows.Next() {
		var i Model
		if err := rows.Scan(
			&i.TeamID,
			&i.Name,
			&i.CreatedAt,
			&i.PermissionManageWorkspaces,
			&i.PermissionManageVCS,
			&i.PermissionManageModules,
			&i.OrganizationName,
			&i.SSOTeamID,
			&i.Visibility,
			&i.PermissionManagePolicies,
			&i.PermissionManagePolicyOverrides,
			&i.PermissionManageProviders,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const insertTeam = `-- name: InsertTeam :exec
INSERT INTO teams (
    team_id,
    name,
    created_at,
    organization_name,
    visibility,
    sso_team_id,
    permission_manage_workspaces,
    permission_manage_vcs,
    permission_manage_modules,
    permission_manage_providers,
    permission_manage_policies,
    permission_manage_policy_overrides
) VALUES (
    $1,
    $2,
    $3,
    $4,
    $5,
    $6,
    $7,
    $8,
    $9,
    $10,
    $11,
    $12
)
`

type InsertTeamParams struct {
	ID                              resource.ID
	Name                            pgtype.Text
	CreatedAt                       pgtype.Timestamptz
	OrganizationName                organization.Name
	Visibility                      pgtype.Text
	SSOTeamID                       pgtype.Text
	PermissionManageWorkspaces      pgtype.Bool
	PermissionManageVCS             pgtype.Bool
	PermissionManageModules         pgtype.Bool
	PermissionManageProviders       pgtype.Bool
	PermissionManagePolicies        pgtype.Bool
	PermissionManagePolicyOverrides pgtype.Bool
}

func (q *Queries) InsertTeam(ctx context.Context, db DBTX, arg InsertTeamParams) error {
	_, err := db.Exec(ctx, insertTeam,
		arg.ID,
		arg.Name,
		arg.CreatedAt,
		arg.OrganizationName,
		arg.Visibility,
		arg.SSOTeamID,
		arg.PermissionManageWorkspaces,
		arg.PermissionManageVCS,
		arg.PermissionManageModules,
		arg.PermissionManageProviders,
		arg.PermissionManagePolicies,
		arg.PermissionManagePolicyOverrides,
	)
	return err
}

const insertTeamToken = `-- name: InsertTeamToken :exec

INSERT INTO team_tokens (
    team_token_id,
    created_at,
    team_id,
    expiry
) VALUES (
    $1,
    $2,
    $3,
    $4
) ON CONFLICT (team_id) DO UPDATE
  SET team_token_id = $1,
      created_at    = $2,
      expiry        = $4
`

type InsertTeamTokenParams struct {
	TeamTokenID resource.ID
	CreatedAt   pgtype.Timestamptz
	TeamID      resource.ID
	Expiry      pgtype.Timestamptz
}

// team tokens
func (q *Queries) InsertTeamToken(ctx context.Context, db DBTX, arg InsertTeamTokenParams) error {
	_, err := db.Exec(ctx, insertTeamToken,
		arg.TeamTokenID,
		arg.CreatedAt,
		arg.TeamID,
		arg.Expiry,
	)
	return err
}

const updateTeamByID = `-- name: UpdateTeamByID :one
UPDATE teams
SET
    name = $1,
    visibility = $2,
    sso_team_id = $3,
    permission_manage_workspaces = $4,
    permission_manage_vcs = $5,
    permission_manage_modules = $6,
    permission_manage_providers = $7,
    permission_manage_policies = $8,
    permission_manage_policy_overrides = $9
WHERE team_id = $10
RETURNING team_id
`

type UpdateTeamByIDParams struct {
	Name                            pgtype.Text
	Visibility                      pgtype.Text
	SSOTeamID                       pgtype.Text
	PermissionManageWorkspaces      pgtype.Bool
	PermissionManageVCS             pgtype.Bool
	PermissionManageModules         pgtype.Bool
	PermissionManageProviders       pgtype.Bool
	PermissionManagePolicies        pgtype.Bool
	PermissionManagePolicyOverrides pgtype.Bool
	TeamID                          resource.ID
}

func (q *Queries) UpdateTeamByID(ctx context.Context, db DBTX, arg UpdateTeamByIDParams) (resource.ID, error) {
	row := db.QueryRow(ctx, updateTeamByID,
		arg.Name,
		arg.Visibility,
		arg.SSOTeamID,
		arg.PermissionManageWorkspaces,
		arg.PermissionManageVCS,
		arg.PermissionManageModules,
		arg.PermissionManageProviders,
		arg.PermissionManagePolicies,
		arg.PermissionManagePolicyOverrides,
		arg.TeamID,
	)
	var team_id resource.ID
	err := row.Scan(&team_id)
	return team_id, err
}
